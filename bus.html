<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bus Ticket Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a2e46;
            color: #1f2937;
        }

        .gradient-button {
            background-image: linear-gradient(to right, #22c55e, #16a34a);
            transition: transform 0.2s ease-in-out;
        }

        .gradient-button:hover {
            transform: scale(1.05);
            background-image: linear-gradient(to right, #16a34a, #22c55e);
        }

        .details-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }

        .details-container.open {
            max-height: 500px; /* Adjust based on content height */
        }
        
        .timeline {
            position: relative;
            padding-left: 2rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #d1d5db;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 5px;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            background-color: #2563eb;
            border: 3px solid white;
            z-index: 1;
        }
        .bus-icon {
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            z-index: 2;
            pointer-events: none;
        }

        .day-change-marker {
            position: relative;
            left: -32px;
            margin-top: -1rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="max-w-4xl w-full bg-white rounded-xl shadow-2xl p-6 md:p-8">

        <!-- Search Bar Section -->
        <h1 class="text-3xl md:text-4xl font-bold text-center mb-6 text-gray-800">Find Your Bus</h1>

        <div class="bg-white rounded-xl p-4 md:p-6 mb-8 shadow-inner">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                <!-- Source Input -->
                <div class="col-span-1 md:col-span-1">
                    <label for="source" class="block text-sm font-medium text-gray-700 mb-1">Source</label>
                    <input type="text" id="source" placeholder="e.g. Ludhiana" class="w-full rounded-md border-2 border-gray-300 p-2.5 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300">
                </div>
                <!-- Destination Input -->
                <div class="col-span-1 md:col-span-1">
                    <label for="destination" class="block text-sm font-medium text-gray-700 mb-1">Destination</label>
                    <input type="text" id="destination" placeholder="e.g. Amritsar" class="w-full rounded-md border-2 border-gray-300 p-2.5 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300">
                </div>
                <!-- Date Input -->
                <div class="col-span-1 md:col-span-1">
                    <label for="date" class="block text-sm font-medium text-gray-700 mb-1">Travel Date</label>
                    <input type="date" id="date" class="w-full rounded-md border-2 border-gray-300 p-2.5 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300">
                </div>
                <!-- Search Button -->
                <div class="col-span-1 md:col-span-1">
                    <button id="searchBtn" class="w-full rounded-md bg-blue-600 text-white font-semibold py-2.5 px-4 hover:bg-blue-700 transition-all duration-300 transform hover:scale-105">
                        Search Buses
                    </button>
                </div>
            </div>
        </div>

        <!-- Bus List Section -->
        <div id="resultsContainer" class="hidden">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-semibold text-gray-800">Available Buses</h2>
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-600">Sort by:</span>
                    <select id="sortSelect" class="rounded-md border-2 border-gray-300 p-2 text-sm focus:ring-2 focus:ring-blue-500">
                        <option value="departure_asc">Departure (Early to Late)</option>
                        <option value="departure_desc">Departure (Late to Early)</option>
                    </select>
                </div>
                <div class="flex space-x-2">
                    <button id="refreshBtn" class="p-2 bg-gray-200 rounded-md text-gray-600 hover:bg-gray-300 transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
                            <path d="M21.5 2v6h-6"/><path d="M2.5 22v-6h6"/><path d="M2 11.5a10 10 0 0 1 18.23-5.35L22 8M22 12.5A10 10 0 0 1 3.77 17.85L2 16"/>
                        </svg>
                    </button>
                    <button id="shareBtnAll" class="p-2 bg-gray-200 rounded-md text-gray-600 hover:bg-gray-300 transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5">
                            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div id="busList" class="space-y-6">
                <!-- Bus cards will be dynamically inserted here -->
            </div>
            <p id="noResults" class="hidden text-center text-gray-500 mt-8">No buses found for this route.</p>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="hidden flex justify-center items-center h-48">
            <svg class="animate-spin h-8 w-8 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        </div>

    </div>
    
    <!-- AI Floating Button -->
    <button class="fixed bottom-6 right-6 p-4 bg-orange-500 text-white font-semibold rounded-full shadow-lg hover:bg-orange-600 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-orange-500 focus:ring-opacity-50">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
        </svg>
    </button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchBtn = document.getElementById('searchBtn');
            const sourceInput = document.getElementById('source');
            const destinationInput = document.getElementById('destination');
            const busListContainer = document.getElementById('busList');
            const resultsContainer = document.getElementById('resultsContainer');
            const noResultsMessage = document.getElementById('noResults');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const sortSelect = document.getElementById('sortSelect');
            const refreshBtn = document.getElementById('refreshBtn');
            const shareBtnAll = document.getElementById('shareBtnAll');
            
            let currentBuses = [];
            let busCardCounter = 0;

            // Hardcoded mock data for demonstration, personalized for Punjab
            const busData = [
                {
                    source: "Ludhiana",
                    destination: "Amritsar",
                    operator: "Punjab Roadways",
                    departureTime: "08:00 AM",
                    arrivalTime: "12:00 PM",
                    duration: "4h",
                    rating: "4.4",
                    seatingTypes: [
                        { name: "Seater", seats: 12 },
                        { name: "Sleeper", seats: 12 },
                        { name: "Private Sleeper", seats: 12 }
                    ],
                    amenities: ["AC", "Water Bottle", "Blanket"],
                    boardingPoint: "ISBT Ludhiana Gate 1, Platform No. 5",
                    droppingPoint: "Amritsar Bus Stand",
                    liveStatus: "On Time",
                    currentLocation: "Jalandhar Bypass",
                    mapLink: "https://www.google.com/maps/dir/Ludhiana,+Punjab,+India/Amritsar,+Punjab,+India",
                    stops: [
                        { time: "08:00 AM", location: "ISBT Ludhiana Gate 1", desc: "Boarding Point", current: false },
                        { time: "09:00 AM", location: "Jalandhar Bypass", desc: "Bus Stop", current: true },
                        { time: "10:30 AM", location: "Kartarpur", desc: "City Center", current: false },
                        { time: "12:00 PM", location: "Amritsar Bus Stand", desc: "Dropping Point", current: false }
                    ]
                },
                {
                    source: "Ludhiana",
                    destination: "Amritsar",
                    operator: "New Star Travels",
                    departureTime: "09:30 AM",
                    arrivalTime: "01:30 PM",
                    duration: "4h",
                    rating: "4.6",
                    seatingTypes: [
                        { name: "AC Seater", seats: 20 },
                        { name: "AC Sleeper", seats: 10 },
                        { name: "Private Sleeper", seats: 5 }
                    ],
                    amenities: ["AC", "WiFi", "Water Bottle"],
                    boardingPoint: "Bharat Nagar Chowk, near Metro Bus Stop",
                    droppingPoint: "Golden Temple, Amritsar",
                    liveStatus: "Delayed by 15 mins",
                    currentLocation: "Ludhiana Bypass",
                    mapLink: "https://www.google.com/maps/dir/Ludhiana,+Punjab,+India/Amritsar,+Punjab,+India",
                    stops: [
                        { time: "09:30 AM", location: "Bharat Nagar Chowk", desc: "Boarding Point", current: true },
                        { time: "11:00 AM", location: "Jalandhar Bybass", desc: "Bus Stop", current: false },
                        { time: "12:30 PM", location: "Town Hall, Amritsar", desc: "City Center", current: false },
                        { time: "01:30 PM", location: "Golden Temple, Amritsar", desc: "Dropping Point", current: false }
                    ]
                },
                {
                    source: "Ludhiana",
                    destination: "Amritsar",
                    operator: "Royal Transport",
                    departureTime: "06:00 PM",
                    arrivalTime: "10:00 PM",
                    duration: "4h",
                    rating: "4.1",
                    seatingTypes: [
                        { name: "Seater", seats: 25 },
                        { name: "Sleeper", seats: 15 }
                    ],
                    amenities: ["AC", "Charging Point"],
                    boardingPoint: "Ferozepur Road, near MBD Mall",
                    droppingPoint: "Hall Gate, Amritsar",
                    liveStatus: "On Time",
                    currentLocation: "Jalandhar Bus Stand",
                    mapLink: "https://www.google.com/maps/dir/Ludhiana,+Punjab,+India/Amritsar,+Punjab,+India",
                    stops: [
                        { time: "06:00 PM", location: "Ferozepur Road", desc: "Boarding Point", current: false },
                        { time: "07:30 PM", location: "Jalandhar Bus Stand", desc: "Bus Stop", current: true },
                        { time: "09:00 PM", location: "Model Town, Amritsar", desc: "City Center", current: false },
                        { time: "10:00 PM", location: "Hall Gate, Amritsar", desc: "Dropping Point", current: false }
                    ]
                },
                {
                    source: "Ludhiana",
                    destination: "Jalandhar",
                    operator: "Orbit Bus",
                    departureTime: "10:30 AM",
                    arrivalTime: "12:30 PM",
                    duration: "2h",
                    rating: "4.2",
                    seatingTypes: [
                        { name: "Seater", seats: 25 },
                        { name: "Sleeper", seats: 15 }
                    ],
                    amenities: ["AC", "Charging Point"],
                    boardingPoint: "ISBT Ludhiana, Platform No. 7",
                    droppingPoint: "Jalandhar City Bus Stand",
                    liveStatus: "On Time",
                    currentLocation: "Phagwara Bypass",
                    mapLink: "https://www.google.com/maps/dir/Ludhiana,+Punjab,+India/Jalandhar,+Punjab,+India",
                    stops: [
                        { time: "10:30 AM", location: "ISBT Ludhiana", desc: "Boarding Point", current: false },
                        { time: "11:30 AM", location: "Phagwara Bypass", desc: "Bus Stop", current: true },
                        { time: "12:30 PM", location: "Jalandhar City Bus Stand", desc: "Dropping Point", current: false }
                    ]
                },
                {
                    source: "Ludhiana",
                    destination: "Jalandhar",
                    operator: "Golden Lines",
                    departureTime: "02:00 PM",
                    arrivalTime: "04:00 PM",
                    duration: "2h",
                    rating: "4.5",
                    seatingTypes: [
                        { name: "Non-AC Seater", seats: 30 },
                        { name: "Private Sleeper", seats: 8 }
                    ],
                    amenities: ["Water Bottle"],
                    boardingPoint: "Model Town Ext., near the Gurudwara",
                    droppingPoint: "Jalandhar Bypass",
                    liveStatus: "Arrived at destination",
                    currentLocation: "Jalandhar Bypass",
                    mapLink: "https://www.google.com/maps/dir/Ludhiana,+Punjab,+India/Jalandhar,+Punjab,+India",
                    stops: [
                        { time: "02:00 PM", location: "Model Town Ext.", desc: "Boarding Point", current: false },
                        { time: "03:00 PM", location: "Phillaur", desc: "Bus Stop", current: false },
                        { time: "04:00 PM", location: "Jalandhar Bypass", desc: "Dropping Point", current: true }
                    ]
                },
                {
                    source: "Amritsar",
                    destination: "Chandigarh",
                    operator: "CTU",
                    departureTime: "09:00 AM",
                    arrivalTime: "02:00 PM",
                    duration: "5h",
                    rating: "4.0",
                    seatingTypes: [
                        { name: "Seater", seats: 8 },
                        { name: "Sleeper", seats: 10 }
                    ],
                    amenities: ["Water Bottle"],
                    boardingPoint: "Amritsar Bus Stand, outside Platform 3",
                    droppingPoint: "ISBT Chandigarh",
                    liveStatus: "On Time",
                    currentLocation: "Ludhiana Bus Stand",
                    mapLink: "https://www.google.com/maps/dir/Amritsar,+Punjab,+India/Chandigarh,+India",
                    stops: [
                        { time: "09:00 AM", location: "Amritsar Bus Stand", desc: "Boarding Point", current: false },
                        { time: "10:30 AM", location: "Jalandhar Bypass", desc: "Bus Stop", current: false },
                        { time: "12:00 PM", location: "Ludhiana Bus Stand", desc: "Bus Stop", current: true },
                        { time: "01:30 PM", location: "Kharar Bypass", desc: "Bus Stop", current: false },
                        { time: "02:00 PM", location: "ISBT Chandigarh", desc: "Dropping Point", current: false }
                    ]
                },
                {
                    source: "Amritsar",
                    destination: "Chandigarh",
                    operator: "Maharaja Travels",
                    departureTime: "11:30 AM",
                    arrivalTime: "04:30 PM",
                    duration: "5h",
                    rating: "4.3",
                    seatingTypes: [
                        { name: "AC Seater", seats: 15 },
                        { name: "AC Sleeper", seats: 10 },
                        { name: "Private Sleeper", seats: 10 }
                    ],
                    amenities: ["AC", "Blanket"],
                    boardingPoint: "Amritsar Bus Stand, near Booking Counter",
                    droppingPoint: "Sector 17, Chandigarh",
                    liveStatus: "Delayed by 30 mins",
                    currentLocation: "Jalandhar City Center",
                    mapLink: "https://www.google.com/maps/dir/Amritsar,+Punjab,+India/Chandigarh,+India",
                    stops: [
                        { time: "11:30 AM", location: "Amritsar Bus Stand", desc: "Boarding Point", current: false },
                        { time: "01:00 PM", location: "Jalandhar City Center", desc: "Bus Stop", current: true },
                        { time: "03:00 PM", location: "Mohali Bypass", desc: "Bus Stop", current: false },
                        { time: "04:30 PM", location: "Sector 17, Chandigarh", desc: "Dropping Point", current: false }
                    ]
                },
                {
                    source: "Jalandhar",
                    destination: "Chandigarh",
                    operator: "Raj Travels",
                    departureTime: "06:00 AM",
                    arrivalTime: "10:00 AM",
                    duration: "4h",
                    rating: "4.5",
                    seatingTypes: [
                        { name: "AC Sleeper", seats: 5 }
                    ],
                    amenities: ["AC", "Blanket", "Water Bottle"],
                    boardingPoint: "Jalandhar Bus Stand, Platform 2",
                    droppingPoint: "Sector 17, Chandigarh",
                    liveStatus: "On Time",
                    currentLocation: "Ludhiana Bypass",
                    mapLink: "https://www.google.com/maps/dir/Jalandhar,+Punjab,+India/Chandigarh,+India",
                    stops: [
                        { time: "06:00 AM", location: "Jalandhar Bus Stand", desc: "Boarding Point", current: false },
                        { time: "07:30 AM", location: "Ludhiana Bypass", desc: "Bus Stop", current: true },
                        { time: "08:45 AM", location: "Kharar Bus Stand", desc: "Bus Stop", current: false },
                        { time: "10:00 AM", location: "Sector 17, Chandigarh", desc: "Dropping Point", current: false }
                    ]
                },
                {
                    source: "Ludhiana",
                    destination: "Delhi",
                    operator: "Zingbus",
                    departureTime: "11:00 PM",
                    arrivalTime: "06:00 AM",
                    duration: "7h",
                    rating: "4.7",
                    seatingTypes: [
                        { name: "AC Sleeper", seats: 18 },
                        { name: "AC Seater", seats: 20 }
                    ],
                    amenities: ["AC", "WiFi", "Blanket", "Water Bottle"],
                    boardingPoint: "Ludhiana Bypass, near toll plaza",
                    droppingPoint: "Delhi ISBT Kashmere Gate",
                    liveStatus: "On Time",
                    currentLocation: "Ambala Cantt",
                    mapLink: "https://www.google.com/maps/dir/Ludhiana,+Punjab,+India/Delhi,+India",
                    stops: [
                        { time: "11:00 PM", location: "Ludhiana Bypass", desc: "Boarding Point", current: false },
                        { time: "02:00 AM", location: "Ambala Cantt", desc: "Bus Stop", current: true },
                        { time: "04:00 AM", location: "Karnal Bypass", desc: "Bus Stop", current: false },
                        { time: "06:00 AM", location: "Delhi ISBT Kashmere Gate", desc: "Dropping Point", current: false }
                    ],
                    overnight: true
                },
                {
                    source: "Ludhiana",
                    destination: "Delhi",
                    operator: "New Punjab Travels",
                    departureTime: "09:00 PM",
                    arrivalTime: "05:00 AM",
                    duration: "8h",
                    rating: "4.0",
                    seatingTypes: [
                        { name: "Seater", seats: 25 },
                        { name: "Sleeper", seats: 18 }
                    ],
                    amenities: ["AC", "Water Bottle"],
                    boardingPoint: "Ludhiana Bus Stand, Main Gate",
                    droppingPoint: "Gurgaon Bus Stand",
                    liveStatus: "On Time",
                    currentLocation: "Panipat Bus Stop",
                    mapLink: "https://www.google.com/maps/dir/Ludhiana,+Punjab,+India/Delhi,+India",
                    stops: [
                        { time: "09:00 PM", location: "Ludhiana Bus Stand", desc: "Boarding Point", current: false },
                        { time: "11:30 PM", location: "Panipat Bus Stop", desc: "Bus Stop", current: true },
                        { time: "03:00 AM", location: "Dhaula Kuan", desc: "Bus Stop", current: false },
                        { time: "05:00 AM", location: "Gurgaon Bus Stand", desc: "Dropping Point", current: false }
                    ],
                    overnight: true
                },
                {
                    source: "Amritsar",
                    destination: "Jalandhar",
                    operator: "CTU",
                    departureTime: "07:00 AM",
                    arrivalTime: "08:30 AM",
                    duration: "1h 30m",
                    rating: "4.1",
                    seatingTypes: [
                        { name: "Non-AC Seater", seats: 30 }
                    ],
                    amenities: ["Charging Point"],
                    boardingPoint: "Amritsar City Bus Stand, Platform 1",
                    droppingPoint: "Jalandhar Bus Stand",
                    liveStatus: "Arrived at destination",
                    currentLocation: "Jalandhar Bus Stand",
                    mapLink: "https://www.google.com/maps/dir/Amritsar,+Punjab,+India/Jalandhar,+Punjab,+India",
                    stops: [
                        { time: "07:00 AM", location: "Amritsar City Bus Stand", desc: "Boarding Point", current: false },
                        { time: "08:00 AM", location: "Rayya Bypass", desc: "Bus Stop", current: false },
                        { time: "08:30 AM", location: "Jalandhar Bus Stand", desc: "Dropping Point", current: true }
                    ]
                },
                {
                    source: "Amritsar",
                    destination: "Jalandhar",
                    operator: "Sukhmani Transport",
                    departureTime: "03:00 PM",
                    arrivalTime: "04:30 PM",
                    duration: "1h 30m",
                    rating: "4.5",
                    seatingTypes: [
                        { name: "AC Seater", seats: 25 },
                        { name: "Private Sleeper", seats: 5 }
                    ],
                    amenities: ["AC", "WiFi"],
                    boardingPoint: "Amritsar Bypass, near the toll booth",
                    droppingPoint: "Ludhiana Bypass",
                    liveStatus: "On Time",
                    currentLocation: "Kapurthala Chowk",
                    mapLink: "https://www.google.com/maps/dir/Amritsar,+Punjab,+India/Jalandhar,+Punjab,+India",
                    stops: [
                        { time: "03:00 PM", location: "Amritsar Bypass", desc: "Boarding Point", current: false },
                        { time: "03:45 PM", location: "Kapurthala Chowk", desc: "Bus Stop", current: true },
                        { time: "04:30 PM", location: "Ludhiana Bypass", desc: "Dropping Point", current: false }
                    ]
                },
                {
                    source: "Chandigarh",
                    destination: "Patiala",
                    operator: "Royal Travels",
                    departureTime: "10:00 AM",
                    arrivalTime: "12:00 PM",
                    duration: "2h",
                    rating: "4.3",
                    seatingTypes: [
                        { name: "AC Seater", seats: 10 }
                    ],
                    amenities: ["AC"],
                    boardingPoint: "ISBT Sector 43, Chandigarh, Platform 12",
                    droppingPoint: "Patiala Bus Stand",
                    liveStatus: "Delayed by 10 mins",
                    currentLocation: "Zirakpur",
                    mapLink: "https://www.google.com/maps/dir/Chandigarh,+India/Patiala,+Punjab,+India",
                    stops: [
                        { time: "10:00 AM", location: "ISBT Sector 43, Chandigarh", desc: "Boarding Point", current: false },
                        { time: "11:00 AM", location: "Zirakpur", desc: "Bus Stop", current: true },
                        { time: "12:00 PM", location: "Patiala Bus Stand", desc: "Dropping Point", current: false }
                    ]
                },
                {
                    source: "Jalandhar",
                    destination: "Delhi",
                    operator: "Yolo Bus",
                    departureTime: "09:30 PM",
                    arrivalTime: "05:00 AM",
                    duration: "7h 30m",
                    rating: "4.6",
                    seatingTypes: [
                        { name: "AC Sleeper", seats: 22 }
                    ],
                    amenities: ["AC", "WiFi", "Blanket"],
                    boardingPoint: "Jalandhar Bypass, near HP Petrol Pump",
                    droppingPoint: "Anand Vihar, Delhi",
                    liveStatus: "On Time",
                    currentLocation: "Ludhiana Bypass",
                    mapLink: "https://www.google.com/maps/dir/Jalandhar,+Punjab,+India/Delhi,+India",
                    stops: [
                        { time: "09:30 PM", location: "Jalandhar Bypass", desc: "Boarding Point", current: false },
                        { time: "11:00 PM", location: "Ludhiana Bypass", desc: "Bus Stop", current: true },
                        { time: "02:00 AM", location: "Karnal", desc: "Bus Stop", current: false },
                        { time: "05:00 AM", location: "Anand Vihar, Delhi", desc: "Dropping Point", current: false }
                    ],
                    overnight: true
                },
                {
                    source: "Patiala",
                    destination: "Ludhiana",
                    operator: "Himachal Roadways",
                    departureTime: "02:00 PM",
                    arrivalTime: "04:00 PM",
                    duration: "2h",
                    rating: "3.9",
                    seatingTypes: [
                        { name: "Non-AC Seater", seats: 15 }
                    ],
                    amenities: ["Water Bottle"],
                    boardingPoint: "Patiala Bus Stand, Platform 4",
                    droppingPoint: "ISBT Ludhiana",
                    liveStatus: "On Time",
                    currentLocation: "Samana",
                    mapLink: "https://www.google.com/maps/dir/Patiala,+Punjab,+India/Ludhiana,+Punjab,+India",
                    stops: [
                        { time: "02:00 PM", location: "Patiala Bus Stand", desc: "Boarding Point", current: false },
                        { time: "03:00 PM", location: "Samana", desc: "Bus Stop", current: true },
                        { time: "04:00 PM", location: "ISBT Ludhiana", desc: "Dropping Point", current: false }
                    ]
                },
                {
                    source: "Amritsar",
                    destination: "Srinagar",
                    operator: "JKRTC",
                    departureTime: "05:00 AM",
                    arrivalTime: "08:00 PM",
                    duration: "15h",
                    rating: "4.8",
                    seatingTypes: [
                        { name: "AC Sleeper", seats: 9 }
                    ],
                    amenities: ["AC", "Water Bottle", "Snacks"],
                    boardingPoint: "Amritsar City Bus Stand, near Hotel Grand",
                    droppingPoint: "Srinagar Bus Stand",
                    liveStatus: "On Time",
                    currentLocation: "Pathankot",
                    mapLink: "https://www.google.com/maps/dir/Amritsar,+Punjab,+India/Srinagar,+Jammu+and+Kashmir,+India",
                    stops: [
                        { time: "05:00 AM", location: "Amritsar City Bus Stand", desc: "Boarding Point", current: false },
                        { time: "07:00 AM", location: "Pathankot", desc: "Bus Stop", current: true },
                        { time: "01:00 PM", location: "Jammu Tawi", desc: "Bus Stop", current: false },
                        { time: "08:00 PM", location: "Srinagar Bus Stand", desc: "Dropping Point", current: false }
                    ]
                },
                {
                    source: "Chandigarh",
                    destination: "Delhi",
                    operator: "IntrCity SmartBus",
                    departureTime: "11:00 PM",
                    arrivalTime: "07:00 AM",
                    duration: "8h",
                    rating: "4.9",
                    seatingTypes: [
                        { name: "Sleeper", seats: 20 },
                        { name: "Private Sleeper", seats: 10 }
                    ],
                    amenities: ["AC", "WiFi", "Blanket", "Water Bottle"],
                    boardingPoint: "ISBT Sector 43, Chandigarh, Platform 14",
                    droppingPoint: "ISBT Kashmere Gate, Delhi",
                    liveStatus: "On Time",
                    currentLocation: "Ambala Cantt",
                    mapLink: "https://www.google.com/maps/dir/Chandigarh,+India/Delhi,+India",
                    stops: [
                        { time: "11:00 PM", location: "ISBT Sector 43, Chandigarh", desc: "Boarding Point", current: false },
                        { time: "12:30 AM", location: "Ambala Cantt", desc: "Bus Stop", current: true },
                        { time: "02:00 AM", location: "Karnal Bypass", desc: "Bus Stop", current: false },
                        { time: "04:00 AM", location: "Sonipat", desc: "Bus Stop", current: false },
                        { time: "07:00 AM", location: "ISBT Kashmere Gate, Delhi", desc: "Dropping Point", current: false }
                    ],
                    overnight: true
                },
                {
                    source: "Amritsar",
                    destination: "Jaipur",
                    operator: "Maharaja Travels",
                    departureTime: "09:00 PM",
                    arrivalTime: "09:30 AM",
                    duration: "12h 30m",
                    rating: "4.3",
                    seatingTypes: [
                        { name: "AC Sleeper", seats: 15 }
                    ],
                    amenities: ["AC", "Blanket", "Entertainment System"],
                    boardingPoint: "Amritsar City Bus Stand, Platform 8",
                    droppingPoint: "Jaipur Bus Stand",
                    liveStatus: "On Time",
                    currentLocation: "Bathinda",
                    mapLink: "https://www.google.com/maps/dir/Amritsar,+Punjab,+India/Jaipur,+Rajasthan,+India",
                    stops: [
                        { time: "09:00 PM", location: "Amritsar City Bus Stand", desc: "Boarding Point", current: false },
                        { time: "11:00 PM", location: "Bathinda", desc: "Bus Stop", current: true },
                        { time: "02:00 AM", location: "Ganganagar", desc: "Bus Stop", current: false },
                        { time: "05:00 AM", location: "Hanumangarh", desc: "Bus Stop", current: false },
                        { time: "09:30 AM", location: "Jaipur Bus Stand", desc: "Dropping Point", current: false }
                    ],
                    overnight: true
                },
                {
                    source: "Ludhiana",
                    destination: "Gurgaon",
                    operator: "New Punjab Travels",
                    departureTime: "10:00 PM",
                    arrivalTime: "05:00 AM",
                    duration: "7h",
                    rating: "4.0",
                    seatingTypes: [
                        { name: "Seater", seats: 25 },
                        { name: "Sleeper", seats: 18 },
                        { name: "Private Sleeper", seats: 8 }
                    ],
                    amenities: ["AC", "Water Bottle"],
                    boardingPoint: "Ludhiana Bus Stand, Main Gate",
                    droppingPoint: "Gurgaon Bus Stand",
                    liveStatus: "On Time",
                    currentLocation: "Panipat Bypass",
                    mapLink: "https://www.google.com/maps/dir/Ludhiana,+Punjab,+India/Gurgaon,+Haryana,+India",
                    stops: [
                        { time: "10:00 PM", location: "Ludhiana Bus Stand", desc: "Boarding Point", current: false },
                        { time: "01:00 AM", location: "Panipat Bypass", desc: "Bus Stop", current: true },
                        { time: "03:00 AM", location: "Delhi ISBT", desc: "Bus Stop", current: false },
                        { time: "05:00 AM", location: "Gurgaon Bus Stand", desc: "Dropping Point", current: false }
                    ],
                    overnight: true
                },
                {
                    source: "Jalandhar",
                    destination: "Shimla",
                    operator: "Himachal Tours",
                    departureTime: "05:00 AM",
                    arrivalTime: "11:00 AM",
                    duration: "6h",
                    rating: "4.6",
                    seatingTypes: [
                        { name: "Non-AC Seater", seats: 35 }
                    ],
                    amenities: ["Charging Point"],
                    boardingPoint: "Jalandhar Bus Stand, outside Platform 5",
                    droppingPoint: "Shimla Bus Stand",
                    liveStatus: "On Time",
                    currentLocation: "Ropar Bus Stand",
                    mapLink: "https://www.google.com/maps/dir/Jalandhar,+Punjab,+India/Shimla,+Himachal+Pradesh,+India",
                    stops: [
                        { time: "05:00 AM", location: "Jalandhar Bus Stand", desc: "Boarding Point", current: false },
                        { time: "07:00 AM", location: "Ropar Bus Stand", desc: "Bus Stop", current: true },
                        { time: "09:00 AM", location: "Solan", desc: "Bus Stop", current: false },
                        { time: "11:00 AM", location: "Shimla Bus Stand", desc: "Dropping Point", current: false }
                    ]
                },
                {
                    source: "Patiala",
                    destination: "Delhi",
                    operator: "Patiala Express",
                    departureTime: "07:30 PM",
                    arrivalTime: "02:00 AM",
                    duration: "6h 30m",
                    rating: "4.1",
                    seatingTypes: [
                        { name: "AC Seater", seats: 20 }
                    ],
                    amenities: ["AC", "Water Bottle"],
                    boardingPoint: "Patiala City Bus Stand, Gate 3",
                    droppingPoint: "Delhi ISBT Kashmere Gate",
                    liveStatus: "On Time",
                    currentLocation: "Ambala City",
                    mapLink: "https://www.google.com/maps/dir/Patiala,+Punjab,+India/Delhi,+India",
                    stops: [
                        { time: "07:30 PM", location: "Patiala City Bus Stand", desc: "Boarding Point", current: false },
                        { time: "09:00 PM", location: "Ambala City", desc: "Bus Stop", current: true },
                        { time: "11:00 PM", location: "Karnal Bypass", desc: "Bus Stop", current: false },
                        { time: "02:00 AM", location: "Delhi ISBT Kashmere Gate", desc: "Dropping Point", current: false }
                    ],
                    overnight: true
                },
                {
                    source: "Amritsar",
                    destination: "Mumbai",
                    operator: "VRL Travels",
                    departureTime: "06:00 PM",
                    arrivalTime: "08:00 PM",
                    duration: "26h",
                    rating: "4.2",
                    seatingTypes: [
                        { name: "AC Sleeper", seats: 10 },
                        { name: "Non-AC Sleeper", seats: 8 }
                    ],
                    amenities: ["AC", "Blanket", "Pillow"],
                    boardingPoint: "Amritsar Airport, Domestic Terminal",
                    droppingPoint: "Borivali, Mumbai",
                    liveStatus: "On Time",
                    currentLocation: "Jalandhar Bypass",
                    mapLink: "https://www.google.com/maps/dir/Amritsar,+Punjab,+India/Mumbai,+Maharashtra,+India",
                    stops: [
                        { time: "06:00 PM", location: "Amritsar Airport", desc: "Boarding Point", current: false },
                        { time: "11:00 PM", location: "Jalandhar Bypass", desc: "Bus Stop", current: true },
                        { time: "05:00 AM", location: "Jaipur", desc: "Bus Stop", current: false },
                        { time: "01:00 PM", location: "Vadodara", desc: "Bus Stop", current: false },
                        { time: "08:00 PM", location: "Borivali, Mumbai", desc: "Dropping Point", current: false }
                    ],
                    overnight: true
                },
                {
                    source: "Ludhiana",
                    destination: "Chandigarh",
                    operator: "GoBus",
                    departureTime: "09:00 AM",
                    arrivalTime: "11:30 AM",
                    duration: "2h 30m",
                    rating: "4.5",
                    seatingTypes: [
                        { name: "AC Seater", seats: 30 }
                    ],
                    amenities: ["AC", "Charging Point"],
                    boardingPoint: "Ludhiana Bus Stand, Platform 10",
                    droppingPoint: "ISBT Sector 43, Chandigarh",
                    liveStatus: "On Time",
                    currentLocation: "Mohali Bypass",
                    mapLink: "https://www.google.com/maps/dir/Ludhiana,+Punjab,+India/Chandigarh,+India",
                    stops: [
                        { time: "09:00 AM", location: "Ludhiana Bus Stand", desc: "Boarding Point", current: false },
                        { time: "10:30 AM", location: "Mohali Bypass", desc: "Bus Stop", current: true },
                        { time: "11:30 AM", location: "ISBT Sector 43, Chandigarh", desc: "Dropping Point", current: false }
                    ]
                },
                {
                    source: "Delhi",
                    destination: "Ludhiana",
                    operator: "Zingbus",
                    departureTime: "09:30 PM",
                    arrivalTime: "05:00 AM",
                    duration: "7h 30m",
                    rating: "4.7",
                    seatingTypes: [
                        { name: "AC Sleeper", seats: 15 },
                        { name: "AC Seater", seats: 10 }
                    ],
                    amenities: ["AC", "WiFi", "Blanket"],
                    boardingPoint: "Delhi ISBT Kashmere Gate, Platform 1",
                    droppingPoint: "Ludhiana Bus Stand",
                    liveStatus: "On Time",
                    currentLocation: "Ambala Cantt",
                    mapLink: "https://www.google.com/maps/dir/Delhi,+India/Ludhiana,+Punjab,+India",
                    stops: [
                        { time: "09:30 PM", location: "Delhi ISBT Kashmere Gate", desc: "Boarding Point", current: false },
                        { time: "11:30 PM", location: "Karnal", desc: "Bus Stop", current: false },
                        { time: "02:00 AM", location: "Ambala Cantt", desc: "Bus Stop", current: true },
                        { time: "05:00 AM", location: "Ludhiana Bus Stand", desc: "Dropping Point", current: false }
                    ],
                    overnight: true
                },
                {
                    source: "Jalandhar",
                    destination: "Amritsar",
                    operator: "CTU",
                    departureTime: "04:00 PM",
                    arrivalTime: "05:30 PM",
                    duration: "1h 30m",
                    rating: "4.1",
                    seatingTypes: [
                        { name: "Non-AC Seater", seats: 40 }
                    ],
                    amenities: ["Water Bottle"],
                    boardingPoint: "Jalandhar Bus Stand, Gate 1",
                    droppingPoint: "Amritsar Bus Stand",
                    liveStatus: "On Time",
                    currentLocation: "Rayya Bypass",
                    mapLink: "https://www.google.com/maps/dir/Jalandhar,+Punjab,+India/Amritsar,+Punjab,+India",
                    stops: [
                        { time: "04:00 PM", location: "Jalandhar Bus Stand", desc: "Boarding Point", current: false },
                        { time: "05:00 PM", location: "Rayya Bypass", desc: "Bus Stop", current: true },
                        { time: "05:30 PM", location: "Amritsar Bus Stand", desc: "Dropping Point", current: false }
                    ]
                },
                {
                    source: "Chandigarh",
                    destination: "Amritsar",
                    operator: "Raj Travels",
                    departureTime: "08:00 PM",
                    arrivalTime: "01:00 AM",
                    duration: "5h",
                    rating: "4.5",
                    seatingTypes: [
                        { name: "AC Sleeper", seats: 8 }
                    ],
                    amenities: ["AC", "Pillow"],
                    boardingPoint: "Sector 17, Chandigarh, near Bus Stop",
                    droppingPoint: "Amritsar Bus Stand",
                    liveStatus: "On Time",
                    currentLocation: "Ludhiana Bus Stand",
                    mapLink: "https://www.google.com/maps/dir/Chandigarh,+India/Amritsar,+Punjab,+India",
                    stops: [
                        { time: "08:00 PM", location: "Sector 17, Chandigarh", desc: "Boarding Point", current: false },
                        { time: "09:00 PM", location: "Kharar Bypass", desc: "Bus Stop", current: false },
                        { time: "10:30 PM", location: "Ludhiana Bus Stand", desc: "Bus Stop", current: true },
                        { time: "12:00 AM", location: "Jalandhar Bypass", desc: "Bus Stop", current: false },
                        { time: "01:00 AM", location: "Amritsar Bus Stand", desc: "Dropping Point", current: false }
                    ],
                    overnight: true
                }
            ];

            const renderBusCards = (buses) => {
                busListContainer.innerHTML = '';
                if (buses.length === 0) {
                    noResultsMessage.classList.remove('hidden');
                    return;
                }
                noResultsMessage.classList.add('hidden');

                buses.forEach((bus, index) => {
                    let statusColor = '';
                    if (bus.liveStatus === "On Time") {
                        statusColor = 'bg-green-500';
                    } else if (bus.liveStatus.includes("Delayed")) {
                        statusColor = 'bg-orange-500';
                    } else if (bus.liveStatus.includes("Arrived")) {
                        statusColor = 'bg-blue-500';
                    }
                    
                    const currentStopIndex = bus.stops.findIndex(stop => stop.current);
                    const totalStops = bus.stops.length;
                    const progressPercentage = totalStops > 1 ? Math.round((currentStopIndex / (totalStops - 1)) * 100) : 0;

                    const detailsId = `details-${index}`;
                    const busCard = document.createElement('div');
                    busCard.className = 'bg-white rounded-lg shadow-lg p-6 space-y-4 border border-gray-200';
                    busCard.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div class="flex items-center space-x-2">
                                <span class="text-blue-600 font-bold text-xl">${bus.operator.charAt(0)}</span>
                                <div class="flex flex-col">
                                    <span class="font-semibold text-md text-gray-800">${bus.operator}</span>
                                    <div class="flex items-center space-x-1 mt-1">
                                        <div class="bg-green-500 text-white text-xs font-bold rounded px-1 py-0.5">${bus.rating}</div>
                                        <span class="text-sm text-gray-500">
                                            ${bus.seatingTypes.map(s => s.name).join(', ')}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex flex-col items-end">
                                <span class="text-lg font-bold">${bus.departureTime}</span>
                                <span class="text-sm text-gray-500">Departs</span>
                            </div>
                        </div>

                        <div class="flex justify-between items-center">
                            <div>
                                <span class="text-sm text-gray-500">${bus.duration} Journey</span>
                            </div>
                            <div>
                                <span class="text-lg font-bold">${bus.arrivalTime}</span>
                                <span class="text-sm text-gray-500">Arrives</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-around items-center border-t border-b py-4">
                            <div class="flex flex-col items-center">
                                <span class="text-sm font-semibold text-gray-800">Live Status</span>
                                <span class="text-sm text-white font-bold px-2 py-1 rounded-full mt-1 ${statusColor}">${bus.liveStatus}</span>
                                <span class="text-sm text-gray-500 mt-1">Currently at: ${bus.currentLocation}</span>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex items-center justify-between text-sm font-semibold text-gray-700 mb-1">
                                <span>Journey Progress</span>
                                <span>${progressPercentage}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="bg-blue-600 h-2.5 rounded-full" style="width: ${progressPercentage}%"></div>
                            </div>
                        </div>

                        <div class="flex justify-between items-center mt-4 pt-4 border-t border-gray-200">
                            <button class="text-blue-600 hover:text-blue-800 font-semibold text-sm transition-colors duration-200" data-toggle-details="${detailsId}">
                                View Details
                            </button>
                            <div class="flex space-x-4">
                                <button class="text-gray-600 hover:text-blue-500 transition-colors duration-200" onclick="setAlarm('${bus.departureTime}')" title="Set Alarm">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </button>
                                <a href="${bus.mapLink}" target="_blank" class="text-gray-600 hover:text-blue-500 transition-colors duration-200" title="View on Map">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                </a>
                                <button class="text-gray-600 hover:text-blue-500 transition-colors duration-200" onclick="shareBusDetails('${bus.operator}', '${bus.departureTime}', '${bus.source}', '${bus.destination}')" title="Share Bus">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6">
                                        <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <div id="${detailsId}" class="details-container">
                            <div class="p-4 bg-gray-50 rounded-lg mt-4 space-y-4">
                                <div class="timeline">
                                    <div class="text-sm text-gray-500 mb-4">${bus.boardingPoint}</div>
                                    <div class="flex items-center space-x-2 text-sm text-gray-500 justify-center day-change-marker">
                                        <span>--- Journey Begins ---</span>
                                    </div>
                                    ${bus.stops.map(stop => `
                                        <div class="timeline-item">
                                            <div class="flex items-start space-x-4">
                                                <div class="flex-shrink-0 pt-1">
                                                    <div class="text-sm font-bold text-gray-800">${stop.time}</div>
                                                </div>
                                                <div class="flex-grow">
                                                    <div class="font-semibold text-gray-800">${stop.location}</div>
                                                    <div class="text-sm text-gray-500">${stop.desc}</div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                    <div class="flex items-center space-x-2 text-sm text-gray-500 justify-center day-change-marker">
                                        <span>--- Journey Ends ---</span>
                                    </div>
                                    <div class="text-sm text-gray-500 mt-4">${bus.droppingPoint}</div>
                                </div>
                                <div class="mt-4">
                                    <p class="text-sm font-semibold text-gray-700 mb-2">Available Facilities:</p>
                                    <div class="flex flex-wrap gap-4">
                                        ${bus.amenities.map(amenity => `
                                            <div class="flex items-center space-x-2 text-sm text-gray-600">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                                </svg>
                                                <span>${amenity}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    busListContainer.appendChild(busCard);
                });

                // Add event listeners for the new toggle buttons
                document.querySelectorAll('[data-toggle-details]').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const targetId = event.target.dataset.toggleDetails;
                        const detailsElement = document.getElementById(targetId);
                        detailsElement.classList.toggle('open');
                        event.target.textContent = detailsElement.classList.contains('open') ? 'Hide Details' : 'View Details';
                    });
                });
            };

            const sortBusList = (buses) => {
                const sortValue = sortSelect.value;
                if (sortValue === 'departure_asc') {
                    buses.sort((a, b) => {
                        const timeA = new Date(`2000/01/01 ${a.departureTime}`);
                        const timeB = new Date(`2000/01/01 ${b.departureTime}`);
                        return timeA - timeB;
                    });
                } else if (sortValue === 'departure_desc') {
                    buses.sort((a, b) => {
                        const timeA = new Date(`2000/01/01 ${a.departureTime}`);
                        const timeB = new Date(`2000/01/01 ${b.departureTime}`);
                        return timeB - timeA;
                    });
                }
                renderBusCards(buses);
            };

            const performSearch = () => {
                const source = sourceInput.value.trim();
                const destination = destinationInput.value.trim();
                
                if (!source || !destination) {
                    return;
                }

                resultsContainer.classList.add('hidden');
                loadingSpinner.classList.remove('hidden');

                setTimeout(() => {
                    const filteredBuses = busData.filter(bus => 
                        bus.source.toLowerCase() === source.toLowerCase() && 
                        bus.destination.toLowerCase() === destination.toLowerCase()
                    );
                    
                    currentBuses = filteredBuses;
                    loadingSpinner.classList.add('hidden');
                    resultsContainer.classList.remove('hidden');
                    sortBusList(currentBuses);
                }, 1000);
            };

            searchBtn.addEventListener('click', performSearch);
            refreshBtn.addEventListener('click', performSearch);

            shareBtnAll.addEventListener('click', () => {
                const searchLink = `${window.location.origin}${window.location.pathname}?source=${encodeURIComponent(sourceInput.value)}&destination=${encodeURIComponent(destinationInput.value)}`;
                
                if (navigator.share) {
                    navigator.share({
                        title: 'Bus Search Results',
                        text: 'Check out these bus options!',
                        url: searchLink
                    }).catch(console.error);
                } else {
                    document.execCommand('copy');
                    alert('Link copied to clipboard!');
                }
            });

            // Alarm Functionality
            window.setAlarm = (time) => {
                const [timeStr, ampm] = time.split(' ');
                const [hours, minutes] = timeStr.split(':').map(Number);
                let alarmHours = hours;
                if (ampm === 'PM' && hours !== 12) {
                    alarmHours += 12;
                }
                if (ampm === 'AM' && hours === 12) {
                    alarmHours = 0;
                }

                const now = new Date();
                let alarmDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), alarmHours, minutes, 0);

                if (alarmDate.getTime() < now.getTime()) {
                    alarmDate.setDate(alarmDate.getDate() + 1);
                }

                const timeUntilAlarm = alarmDate.getTime() - now.getTime();
                
                setTimeout(() => {
                    alert(`Alarm! Your bus is departing at ${time}.`);
                }, timeUntilAlarm);

                alert(`Alarm set for ${time}! You will be notified.`);
            };

            window.shareBusDetails = (operator, departureTime, source, destination) => {
                const shareText = `Check out this bus from ${source} to ${destination} with ${operator} departing at ${departureTime}.`;
                const shareLink = `${window.location.origin}${window.location.pathname}?source=${encodeURIComponent(source)}&destination=${encodeURIComponent(destination)}`;

                if (navigator.share) {
                    navigator.share({
                        title: 'Bus Details',
                        text: shareText,
                        url: shareLink
                    }).catch(console.error);
                } else {
                    document.execCommand('copy');
                    alert('Details copied to clipboard!');
                }
            };

            sortSelect.addEventListener('change', () => {
                if (currentBuses.length > 0) {
                    sortBusList(currentBuses);
                }
            });
        });
    </script>
</body>
</html>

